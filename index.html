<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask âœ…LinkedIn QARA - Med MindsðŸ”Ž Applicable Standards Selector</title>
    <link rel="icon" href="QARA.png" type="image/png">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            align-items: center;
        }
        #topContainer {
            width: 100%;
            background-color: white;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 20px;
        }
        h1 {
            margin-bottom: 20px;
            background-color: white;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: fit-content;
        }
        #keywordInput {
            width: 50%;
            min-height: 120px;
            margin-bottom: 20px;
            padding: 8px;
            resize: none;
        }
        #buttonContainer {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        #tableContainer {
            width: 100%;
            flex-grow: 1;
            overflow-y: auto;
            border: 1px solid #ccc;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
            cursor: pointer;
        }
        th {
            background-color: #add8e6;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        tr:nth-child(even) {
            background-color: #e6f2ff;
        }
        tr.selected-row {
            background-color: yellow;
        }
        button {
            padding: 10px;
        }
        #loadingIndicator {
            display: none;
            margin-left: 10px;
        }
        #progressMessage {
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-81366NTXDQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-81366NTXDQ');
</script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
 <div id="topContainer">
 <header>
        <img src="https://content.linkedin.com/content/dam/me/business/en-us/amp/brand-site/v2/bg/LI-Logo.svg.original.svg" alt="LinkedIn Logo">
        <a href="https://www.linkedin.com/groups/12741229/">
        <img src="https://media.licdn.com/dms/image/v2/D4E07AQFTIdPpIdlhCQ/group-logo_image-shrink_92x92/group-logo_image-shrink_92x92/0/1670075584338?e=1727884800&v=beta&t=J8szLXmrM9RSWZ2YPdkVfvIgkTSfnP50baeyLTXO6OA" alt="QARA Logo"></a>     
 </header>    
<h1>Ask âœ…LinkedIn QARA - Med MindsðŸ”Ž Applicable Standards Selector</h1>
    <textarea id="keywordInput" placeholder="
        1. Search Context: Enter keywords, standards number, text from document... here.
        2. Click on Submit Context
        3. Select rows that you need with mouse click, they will toggle yellow 
        4. Repeat 1-3 as needed
        5. Export selected rows to a file"></textarea>
    <div id="buttonContainer">
        <button id="submitContext">Submit Context</button>
        <button id="clearContext">Clear Context</button>
        <button id="displaySelected">Display All Selected Rows</button>
        <button id="export">Export Selected Rows</button>
        <button id="reset">Reset</button>
        <span id="loadingIndicator">Loading...</span>
    </div>
    <div id="progressMessage"></div>
 </div>
    <div id="tableContainer">
        <table id="dataTable">
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>
    <script>
        $(document).ready(function() {
            const csvUrl = 'https://martincking.github.io/Standards-Selector/Standards.csv';
            let allRows = []; // Array to store all rows
            let originalRows = []; // Array to store original rows for reference
            let selectedRows = new Set(); // Track selected row indices
            let displayedRows = new Set(); // Track displayed row IDs to avoid duplicates

            $.get(csvUrl, function(data) {
                const lines = data.split('\n').map(line => line.split(','));
                const header = lines[0].slice(0, 4); // Only take the first 4 columns for the header
                const rows = lines.slice(1);

                // Populate table header with only the first 4 columns
                const headerHtml = header.map(col => `<th>${col}</th>`).join('');
                $('#dataTable thead').html(`<tr>${headerHtml}</tr>`);

                // Store all rows in an array, limited to 4 columns
                allRows = rows.map((row, index) => {
                    const limitedRow = row.slice(0, 4); // Limit the row to 4 columns

if (limitedRow.length >= 4) {
    const secondColumnText = limitedRow[1]; // Text in the second column
    const link = limitedRow[3]; // Link in the 4th column

    // If the link is valid (starts with "https://"), else leave it blank
    if (link && link.trim().startsWith('https://')) {
        limitedRow[1] = `<a href="${link}" target="_blank">${secondColumnText}</a>`;
    } else {
        limitedRow[3] = ''; // Leave the 4th column blank if not a valid link
    }

    // Keep the text in the 3rd column unchanged
    const thirdColumnText = limitedRow[2]; // Retain the original 3rd column text
}


                    return `<tr data-id="${index}">${limitedRow.map(cell => `<td>${cell}</td>`).join('')}</tr>`;
                });
                

                originalRows = allRows.slice(); // Keep a reference to the original rows
                $('#dataTable tbody').html(originalRows.join(''));

                // Row click toggle functionality
                $('#dataTable tbody').on('click', 'tr', function() {
                    const rowIndex = $(this).index();
                    $(this).toggleClass('selected-row');
                    if (selectedRows.has(rowIndex)) {
                        selectedRows.delete(rowIndex);
                    } else {
                        selectedRows.add(rowIndex);
                    }
                });

                // Display selected rows
                $('#displaySelected').click(function() {
                    const selectedHtml = $('#dataTable tbody tr.selected-row').clone();
                    const unselectedHtml = $('#dataTable tbody tr').not('.selected-row').clone();

                    if (selectedHtml.length === 0) {
                        // If no selected rows, behave like reset
                        $('#dataTable tbody').html(originalRows.join(''));
                        selectedRows.clear();
                    } else {
                        $('#dataTable tbody').empty().append(selectedHtml).append(unselectedHtml);
                    }
                });

                // Reset button functionality
                $('#reset').click(function() {
                    $('#dataTable tbody tr').removeClass('selected-row');
                    selectedRows.clear();
                    $('#dataTable tbody').html(originalRows.join(''));
                    displayedRows.clear(); // Reset displayed rows
                });

                // Clear Context button functionality
                $('#clearContext').click(function() {
                    $('#keywordInput').val(''); // Clear the keyword input
                    $('#dataTable tbody').html(originalRows.join('')); // Reset table display
                    displayedRows.clear(); // Clear displayed rows
                });

                // Export functionality
                $('#export').click(function() {
                    let csvContent = header.join(',') + '\n';
                    $('#dataTable tbody tr.selected-row').each(function() {
                        const row = $(this).find('td').map(function() {
                            return $(this).text().trim();
                        }).get();
                        if (row.some(cell => cell.length > 0)) {
                            csvContent += row.join(',') + '\n';
                        }
                    });

                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.setAttribute('href', URL.createObjectURL(blob));
                    link.setAttribute('download', 'selected_rows.csv');
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
            });

            // Function to extract keywords and phrases using NLP logic
            function extractKeywords(context) {
                // Simulating advanced NLP: extracting meaningful single words and short phrases
                return context.match(/(?:\w+\s+){0,2}\w+/g) || [];
            }

            // Function to extract numbers from context
            function extractNumbers(context) {
                return context.match(/\d+/g) || []; // Capture all numbers
            }

            // Match and display function for stacking results
            function matchAndDisplay(matchingItems) {
                matchingItems.forEach(item => {
                    allRows.forEach(rowHtml => {
                        const rowText = $(rowHtml).text().toLowerCase(); // Get text of the entire row
                        if (rowText.includes(item.trim().toLowerCase())) {
                            const rowId = $(rowHtml).data('id');
                            if (!displayedRows.has(rowId)) {
                                $('#dataTable tbody').prepend(rowHtml); // Move to the top
                                displayedRows.add(rowId); // Mark this row as displayed
                            }
                        }
                    });
                });
            }

            // Submit Context functionality
            $('#submitContext').click(function() {
                const context = $('#keywordInput').val();
                $('#loadingIndicator').show(); // Show loading indicator
                $('#progressMessage').text('Searching...'); // Show progress message

                // Extract numbers and keywords using advanced NLP
                const numbers = extractNumbers(context);
                const keywords = extractKeywords(context);

                // Match numbers and keywords
                matchAndDisplay(numbers); // Match numbers
                matchAndDisplay(keywords); // Match keywords

                $('#loadingIndicator').hide(); // Hide loading indicator
                $('#progressMessage').text('Search complete.'); // Show completion message
            });
        });
    </script>
</body>
</html>
